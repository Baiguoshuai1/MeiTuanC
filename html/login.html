<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>登录|白国帅的美团网</title>
		<link rel="shortcut icon" type="image/x-icon" href="../img/favicon.ico" />
		<link rel="stylesheet" href="../css/public.css"/>
		<link rel="stylesheet" href="../css/login.css"/>
	</head>
	<body>
		<header class="loginW">
			<a href="MeiTuanIndex.html"><img src="../img/login/1.png" /></a>
		</header>
		<div class="content">
			<div class="loginW body-content">
				<div class="left-imgBox">
					<img src="../img/login/bk.jpg" />
				</div>
				<div class="right-loginBox">
					<form id="form2">
						<div class="validate" style="visibility: hidden;">
							<img src="../img/login/cuo.png"/><span class="prompt">请输入账号</span>
						</div>
						<div class="login-typeBox" >
							<span>账号登录</span><a>手机动态码登录<img width="11" height="14" src="../img/login/phone.png"/></a>
						</div>
						<div class="elem">
							<i class="iconfont">&#xe8da;</i>
							<input type="text" id="t1" name="username" placeholder="手机号/用户名/邮箱" msg="账号"/>
						</div>
						<div class=" elem psd">
							<i class="iconfont">&#xe648;</i>
							<input type="password" id="t2" name="userpass" placeholder="密码" msg="密码"/>
						</div>
						<div class="elem form-check">
							<input class="userYanzheng" type="text" placeholder="验证码" msg="验证码"/>
							<img height="36" width="72" class="yanzhengImg" src="../img/login/captcha (1).jpg"/>
							<span class="yanzheng-text">看不清楚？换一张</span>
						</div>
						<div class="setcookie-box">
							<input type="checkbox" value="1" name="auto_login" id="autologin" class="cookie-checkbox" />
							<label class="normal" for="autologin"><span></span>7天内自动登陆</label>	
							<a href="">忘记密码?</a>
						</div>
						<div class="elem subBox">
							<input type="submit" class="sub-btn" value="登录"/>
						</div>
						<p class="registe">
							还没有账号？<a href="registe.html">免费注册</a>
						</p>
					</form>
					<div class="pingtaiBox">
						<h3 class="tile">
							<span class="sub-title">用合作网站账号登录</span>
						</h3>
						<div class="pingtaiBox-i">
							<a href="https://graph.qq.com/oauth2.0/show?which=Login&display=pc&response_type=code&redirect_uri=https%3A%2F%2Fpassport
								.meituan.com%2Faccount%2Fcallback%2Ftencent&client_id=214506" target="_blank"><i class="iconfont qq">&#xe6d3;</i></a>
							<a href="https://api.weibo.com/oauth2/authorize?response_type=code&redirect_uri=https%3A%2F%2Fpassport.meituan.com%2Faccount
								%2Fcallback%2Fsina&client_id=579809138" target="_blank"><i class="iconfont weibo">&#xe658;</i></a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<footer class="loginW">
			<div class="ceil-box">
				<ul>
					<li class="first"><a href="">关于美团</a></li>
					<li><a href="">关于美团</a></li>
					<li><a href="">加入我们</a></li>
					<li><a href="">商家入驻</a></li>
					<li><a href="">帮助中心</a></li>
					<li class="last"><a href="">美团手机版</a></li>
				</ul>
				<a href=""><img width="276" height="24" src="../img/login/footer-commitment.png"/></a>
			</div>
			<div class="floor-box">
				<p>
					©2018 <a href="">美团网团购</a> meituan.com <a href="">京ICP证070791号</a> 京公网安备11010502025545号 <a href="">电子公告服务规则</a>
				</p>
			</div>
		</footer>
	</body>
</html>
 <script type="text/javascript" src="../js/jquery-3.3.1.min.js" ></script>
 <script type="text/javascript" src="../js/jquery.cookie.js" ></script>
 <script language="JavaScript">
 	$(function(){
 		var checkCount=0;
 		var checkNumber=null;               
   		function radomCheckIMg(){		//生成随机验证码图片
	 		$(".yanzhengImg").attr("src",function(){	
	 			checkNumber=parseInt(Math.random()*20);
	 			return "../img/login/captcha ("+checkNumber+").jpg";	//函数里面的图片号码不能再使用变量，得直接使用随机数
	 		})
   		}
	
 		$(".yanzhengImg").attr("src",function(){	//每次打开网页生成不同的验证码图片
				radomCheckIMg();
 		})
 		
 		$(".yanzheng-text").click(function(){		//点击文字换验证码图片
				radomCheckIMg();
 		})
 		$(".yanzhengImg").click(function(){		//点击图片换验证码图片
 				radomCheckIMg();
 		})
 		
 		function setCookie(c_name,value,expiredays){		//存储cookies
			var exdate=new Date()
			exdate.setDate(exdate.getDate()+expiredays)
			document.cookie=c_name+ "=" +escape(value)+((expiredays==null) ? "" : ";expires="+exdate.toGMTString())+";path="+"/";
		}
 		function checkYan(){
			let Num=["o4W","G78d","Z8UF","BHAe","3CDY","RK7A","HA85","ET9E","XDdu","DL6e","WZFZ","Gpao",
					"aZCA","ZX6S","PDYh","Bd5T","MZFC","S2B7","UZVm","VKVX"]
			for(let i=0;i<Num.length;i++){
			if($(".userYanzheng").val()==Num[i]&&checkNumber==i){
					return true;
				}else{
					continue;
				}
			}
		}
		function inpFunc(){					//验证input不为空
		     let num=0;
		     let str="";
			  $("input").not(".userYanzheng").each(function(n){	//.each(函数)是可以循环找this（有多少个input就循环多少次）这个必须循环因为每个文本框的msg不一样
		          if($(this).val()=="")					//.val()是可以添加文本框的值，也可获取
		          {
		               num++;
		               str="请输入"+$(this).attr("msg");//.attr()是返回指定属性的值
		          }
		      });
		     if(num>0){
 				$(".validate")[0].style.visibility="visible";
 				$(".prompt").html(str)
		          return false;//对jquery函数有效，此处无效
		   		 }
		     else{
		          return true;//对jquery函数有效
				}
    
 	  }
 		var eve=event||window.event;
 		$("#form2").submit(function(eve){
 			if(!eve.isDefaultPrevented()){
 				eve.preventDefault();
 			}
 			if(checkCount>=2){
 				$(".form-check")[0].style.display="block";
 				$(".userYanzheng")[0].focus();
 				$(".userYanzheng")[0].style.borderColor="#2bb8aa";
 				if($(".userYanzheng").val()==""){
 					$(".userYanzheng").blur(function(){
 						$(this)[0].style.borderColor="red";
 					})
 				}
 				$(".userYanzheng").keyup(function(){
 					$(this)[0].style.borderColor="#2bb8aa";
 				})
 				
 			}
 			let ret1=checkYan();
 			let ret2=inpFunc();
 			if(checkCount>=2&&ret1&&ret2&&($(".userYanzheng").val()!=="")||ret2&&checkCount<2){
 				$.ajax({
 				type:"POST",
 				url:"../php/loginCheck.php",
 				data:$("#form2").serialize(),
 				success:function(mes){
 					if(mes==($("#t1").val())){
 						if($("#autologin:eq(0)").is(":checked")){
 							$.cookie($('#t1').val(),$('#t2').val(),{expires:7,path:"/"})
 						}else{
 							$.cookie($('#t1').val(),$('#t2').val(),{path:"/"})
 						}
 						$(".validate")[0].style.visibility="hidden";
 						location.href="MeiTuanLoginBack.html";
 						console.log(document.cookie)
 					}else{
 						checkCount++;
 						$(".validate")[0].style.visibility="visible";
 						$(".prompt").html("账号或密码错误，请重新输入")
 						$(".userYanzheng").val("");
 						//if($(".form-check")[0].style.display=="block"){
 							radomCheckIMg();
 							//}
 						}
 					}
 				})
   			}else if($('#t1').val()==""){
				 $(".prompt").html("请输入用户名")	//用来整理提示顺序	
			}else if($('#t2').val()==""){
			  $(".prompt").html("请输入密码")
			}else if(checkCount>=2&&$(".userYanzheng").val()==""){
				$(".prompt").html("请输入验证码")
			}else if(!ret1){
				$(".validate")[0].style.visibility="visible";
 				$(".prompt").html("验证码输入错误")	
 				$(".userYanzheng").val("");
 				radomCheckIMg();
			}
 		})
 			
 		$(".normal").click(function(){
 			//$(this).children("span").children("i").attr("style","display:block")
 			//$("this").children("input+label").css({borderColor:"pink"})
 			if($("#autologin:eq(0)").is(":checked")){
 				$(this).children("span").attr("style","border-color: #2bb8aa")
 			}
// 			}else{
// 				$(this).children("sapn").attr("style","")
// 			}
 			console.log($("#autologin:eq(0)").is(":checked"))
 		})
// 		if($("#autologin")[0].style.checked=="checked"){
// 			alert("yes")
// 		}
		$(".normal").children("span").hover(function(){
			$(this).attr("style","border-color: #2bb8aa;")
			console.log($("#autologin:eq(0)").is(":checked"))
		},function(){
			if(!$("#autologin:eq(0)").is(":checked")){
			$(this).attr("style","border-color:#ddd")
			}
			console.log($("#autologin:eq(0)").is("checked"))
		})
//		$(".normal").blur(function(){
//			
//		})
 	})
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 	
 </script>